---
title: "prediction"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{prediction}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(plausi)
library(tidyverse)
library(swissdd)

results <- swissdd::get_nationalvotes(from_date="2014-01-01")

pred_res <- results %>%
  filter(canton_id==1& mun_id!=9010) %>% 
  select(mun_id,id, jaStimmenInProzent)

predzh <-pred_res %>% tidyr::spread(id,jaStimmenInProzent)

colnames(predzh) <- paste("v", colnames(predzh), sep = "_")

ausgez_gem <- cantdata_820 %>% 
  filter(canton_name=="ZH"&id==104955&gebietAusgezaehlt==TRUE) %>%
  pull(mun_id)

train <- predzh %>% mutate(v_5850=ifelse(v_mun_id %in% ausgez_gem,NA, v_5850)) %>% 
  rename(v_gemwkid=v_mun_id) %>% 
  mutate(gemeinde="")

hello <- predict_votes("v_5850",train)

votedata1 <- votedata %>% mutate_at(vars(Eidg1,Kant1),~ifelse(v_gemwkid %in% ausgez_gem,NA, .x))

hello2 <- predict_votes(c("Eidg1","Kant1"),train=votedata1,exclude_votes = TRUE)

glimpse(votedata)

```

```{r}


ausgez_gem <- cantdata_820 %>% 
  filter(canton_name=="ZH"&id==104955&gebietAusgezaehlt==TRUE) %>%
  pull(mun_id)

train <- votedata %>% mutate(Eidg1=ifelse(v_gemwkid %in% ausgez_gem,NA, Eidg1))

votedata1 <- votedata %>% mutate_at(vars(Eidg1,Kant1),~ifelse(v_gemwkid %in% ausgez_gem,NA, .x))

hello2 <- predict_votes(c("Eidg1","Kant1"),train=train,exclude_votes = TRUE) 
  
hello2 <- hello2 %>%  mutate(diff=pred-real)





```


<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modelle für Vorhersage optimieren • plausi</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Modelle für Vorhersage optimieren">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">plausi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0.9999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/hochrechnung.html">hochrechnung</a>
    </li>
    <li>
      <a href="../articles/jaanteile.html">Ja-Anteile plausibilisieren</a>
    </li>
    <li>
      <a href="../articles/model_selection.html">Modelle für Vorhersage optimieren</a>
    </li>
    <li>
      <a href="../articles/stimmbeteiligung.html">Auffällige Stimmbeteiligungswerte identifizieren</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Modelle für Vorhersage optimieren</h1>
            
      

      <div class="hidden name"><code>model_selection.Rmd</code></div>

    </div>

    
    
<!-- __WORK IN PROGRESS__ -->
<!-- ```{r, include = FALSE} -->
<!-- knitr::opts_chunk$set( -->
<!--   collapse = TRUE, -->
<!--    comment = "#>", -->
<!--    message = FALSE, -->
<!--    warning= FALSE -->
<!--  ) -->
<!-- ``` -->
<!-- ```{r setup} -->
<!-- library(plausi) -->
<!-- library(caret) -->
<!-- library(tidyverse) -->
<!-- ``` -->
<!-- # Parameter-Tuning mit dem Caret package -->
<!-- ```{r} -->
<!-- # BFS Nummern ausgewählter Gemeinden -->
<!-- bfs_nrs <- c(6,7,10,11,12,87,219,294 ,181,38,60,92,119,182,218) -->
<!-- Sys.setenv(https_proxy="") -->
<!-- # Beziehe historische Daten -->
<!-- results <- swissdd::get_nationalvotes(from_date="2015-03-01", to_date="2020-11-29") -->
<!-- # Formattiere historische Daten um : eine Spalte je Vorlage -->
<!-- testdata <- results %>% -->
<!--   filter(canton_id==1) %>%  -->
<!--   mutate(id=paste0("v",id)) %>% -->
<!--   dplyr::select(jaStimmenInProzent, id, mun_id, mun_name) %>% -->
<!--   pivot_wider(names_from=id, values_from = jaStimmenInProzent) %>%  -->
<!--   drop_na() -->
<!-- traind <- testdata %>%  -->
<!--   mutate_at(vars(v6360),# vars(v6360,v6370), -->
<!--             ~ifelse(mun_id %in% bfs_nrs,., NA)) %>%  -->
<!--   drop_na() -->
<!-- svmGrid <- expand.grid(sigma= 2^c(-25, -20, -15,-10, -5, 0), C= 2^c(0:5)) -->
<!-- svm_mod <- train( -->
<!--   v6360 ~ .,  -->
<!--   data = traind %>% dplyr::select(-mun_id,-mun_name), -->
<!--   method = "svmRadial",                -->
<!--   trControl = trainControl(method = "cv", number = 10), -->
<!--   tuneGrid = svmGrid, -->
<!--   tuneLength = 10 -->
<!-- ) -->
<!-- svm_mod -->
<!-- svm_mod$results -->
<!-- ggplot(svm_mod) +  -->
<!--   theme_light() -->
<!-- testdata$newpred <- predict(svm_mod, testdata) -->
<!-- testdata %>% select(mun_id,mun_name, v6360,newpred) -->
<!-- ``` -->
<!-- # Paramter-Tuning mit dem plausi-package -->
<!-- Das Tuning-Grid kann den Funktionen des plausi-packages ebenfalls übergeben werden. -->
<!-- ```{r} -->
<!-- # works -->
<!-- predict_single_vote("v6360", -->
<!--                     traindata=traind,  -->
<!--                     testdata=testdata, -->
<!--                     method="svmRadial", -->
<!--                     geovars=c("mun_id","mun_name" ), -->
<!--                     tuneGrid=svmGrid, -->
<!--                     tuneLength = 10) -->
<!-- # working - dots are now passed as intended -->
<!-- predict_votes(votes=c("v6360"), -->
<!--                     train=traind,  -->
<!--                     test=testdata, -->
<!--                     method="svmRadial", -->
<!--                     geovars=c("mun_id","mun_name"), -->
<!--                     tuneGrid=svmGrid, -->
<!--                     tuneLength = 10) -->
<!-- ``` -->
<!-- # Modelle vergleichen -->
<!-- Plausi baut auf dem caret-package auf und lässt es somit zu, zwischen unzähligen Machine-Learning Algorithmen zu wählen und einfach umzustellen. Dies erleichtert es Modelle hinsichtlich Vorhersagegenauigkeit zu vergleichen. -->
<!-- Das 'gvcEarth' Model, ein MARS-Modell aus dem 'earth' package (Splines) wie auch ein svm-Modell schneiden am besten ab. Doch neben der Vorhersagegenauigkeit sollte das Modell auch möglichst robust gegenüber einzelnen vermeintlich falschen Resultaten sein bzw. diese sollten die Vorhersage für eine Gemeinde nicht zu stark beeinflussen. -->
<!-- - gcvEarth offers the best accuracy, however seems to be prone to overfit in case of false results (real example: Rüti with switched yes and no-shares) -->
<!-- - svmRadial is a bit less acurate on average however seems not to be affected by single false results -->
<!-- ```{r define models} -->
<!-- # Modelle die verglichen werden sollen -->
<!-- models <- c("gcvEarth","glmboost","pls","pcr","svmRadial") -->
<!-- # Funktion für Vergleich unterschiedlicher Modelle -->
<!-- test_models <- function(votes, train,test, model,...){ -->
<!-- plausi::predict_votes(votes = votes,  -->
<!--                           train = train, -->
<!--                           test=test, -->
<!--                            method = model, -->
<!--                           exclude_votes = TRUE, -->
<!--               ...) %>%  -->
<!--     dplyr::mutate(mod=model)  -->
<!-- } -->
<!-- #Vergleich anhand der Vorhersage für drei Vorlagen -->
<!-- comparison <- map_dfr(models, ~test_models(votes=colnames(train)[c(-1,-2)][1:3], -->
<!--                                         train=train, -->
<!--                                         test=testdata, -->
<!--                                         model=.x, -->
<!--                                         geovars=c("mun_id","mun_name"))) -->
<!-- # Vorhersagefehler je Modell pro Vorlage -->
<!-- comparison %>%  -->
<!--   group_by(vorlage,mod) %>%  -->
<!--   summarize(rmse=RMSE(pred,real,na.rm=TRUE)) -->
<!-- ``` -->
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Thomas Lo Russo, Simon Graf.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
